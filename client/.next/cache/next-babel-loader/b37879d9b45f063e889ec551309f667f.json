{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Sarthak\\\\YT_Workflow_Cloud\\\\client\\\\pages\\\\dashboard\\\\workflows.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport styles from '../../styles/scss/workflows.module.scss';\nimport classnames from 'classnames';\nimport { useEffect, useState } from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport { setJwt } from '../../components/actions/jwtAction';\nimport { setWorkflowInfo } from '../../components/actions/workflowInfo';\nimport DashboardMenu from '../../components/DashboardMenu';\nimport WorkflowItem from '../../components/WorkflowItem';\nimport Cookie from 'js-cookie';\nimport Router from 'next/router';\n\nvar Dashboard = function Dashboard() {\n  _s();\n\n  var _useState = useState(null),\n      workflows = _useState[0],\n      setWorkflows = _useState[1];\n\n  var jwtToken = useSelector(function (state) {\n    return state.jwtToken;\n  });\n  var dispatch = useDispatch();\n\n  var _useState2 = useState([]),\n      origWorkflow = _useState2[0],\n      setOrigWorkflow = _useState2[1];\n\n  var _useState3 = useState(''),\n      curFilter = _useState3[0],\n      setCurFilter = _useState3[1];\n\n  if (jwtToken === '') {\n    Router.push('/');\n  }\n\n  var setWorkflowIdsInLocalStorage = function setWorkflowIdsInLocalStorage(workflowsInfo) {\n    var workflowIds = workflowsInfo.map(function (workflowInfo) {\n      return workflowInfo.id;\n    });\n\n    if (!localStorage.getItem('workflowIds')) {\n      localStorage.setItem('workflowIds', workflowIds);\n    }\n  };\n\n  var getNewJwtToken = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var refreshToken, data, dataStringified, newAccessTokenRes, newAccessTokenJson, newJwtToken, workflowsResponse, workflowsJson;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              refreshToken = localStorage.getItem('refresh-token');\n              data = {\n                refresh: refreshToken\n              };\n              dataStringified = JSON.stringify(data);\n              _context.next = 5;\n              return fetch('http://127.0.0.1:8000/api/refresh', {\n                method: 'POST',\n                body: dataStringified,\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n\n            case 5:\n              newAccessTokenRes = _context.sent;\n              _context.next = 8;\n              return newAccessTokenRes.json();\n\n            case 8:\n              newAccessTokenJson = _context.sent;\n\n              if (!(newAccessTokenJson.detail === 'Token is invalid or expired')) {\n                _context.next = 15;\n                break;\n              }\n\n              localStorage.setItem('refresh-token', '');\n              Cookie.set('jwt', JSON.stringify(''));\n              Cookie.set('refresh-token', JSON.stringify(''));\n              dispatch(setJwt(''));\n              return _context.abrupt(\"return\", Router.push('/'));\n\n            case 15:\n              newJwtToken = newAccessTokenJson.access;\n              dispatch(setJwt(newJwtToken));\n              localStorage.setItem('jwt', newJwtToken);\n              Cookie.set('jwt', JSON.stringify(newJwtToken));\n              _context.next = 21;\n              return fetch('http://localhost:8000/get-workflows', {\n                headers: {\n                  Authorization: 'Bearer ' + newJwtToken\n                }\n              });\n\n            case 21:\n              workflowsResponse = _context.sent;\n              _context.next = 24;\n              return workflowsResponse.json();\n\n            case 24:\n              workflowsJson = _context.sent;\n              setWorkflows(workflowsJson['workflows']);\n              dispatch(setWorkflowInfo(workflowsJson['workflows']));\n              setWorkflowIdsInLocalStorage(workflowsJson['workflows']);\n\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function getNewJwtToken() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var getWorkflows = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var jwtBearerString, workflowsResponse, workflowsJson, tempWorkflows, orig;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              jwtBearerString = 'Bearer ' + jwtToken;\n              _context2.next = 3;\n              return fetch('http://localhost:8000/get-workflows', {\n                headers: {\n                  Authorization: jwtBearerString\n                }\n              });\n\n            case 3:\n              workflowsResponse = _context2.sent;\n              _context2.next = 6;\n              return workflowsResponse.json();\n\n            case 6:\n              workflowsJson = _context2.sent;\n\n              if (!workflowsJson.code) {\n                _context2.next = 11;\n                break;\n              }\n\n              _context2.next = 10;\n              return getNewJwtToken();\n\n            case 10:\n              return _context2.abrupt(\"return\");\n\n            case 11:\n              tempWorkflows = workflowsJson['workflows'];\n              orig = tempWorkflows.sort(function (w1, w2) {\n                if (w1.id > w2.id) return -1;\n                return 1;\n              });\n              setWorkflows(_toConsumableArray(orig));\n              setOrigWorkflow(_toConsumableArray(orig));\n\n            case 15:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function getWorkflows() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    getWorkflows();\n  }, []);\n\n  var createWorkflow = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n      var res, resJson, newWorkflowInfo;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return fetch('http://localhost:8000/create-workflow', {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json',\n                  Authorization: 'Bearer ' + jwtToken\n                }\n              });\n\n            case 2:\n              res = _context3.sent;\n              _context3.next = 5;\n              return res.json();\n\n            case 5:\n              resJson = _context3.sent;\n              newWorkflowInfo = resJson['workflow'];\n              Router.push(\"/../workflow/\".concat(newWorkflowInfo.id));\n\n            case 8:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function createWorkflow() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var filterByUnfinished = function filterByUnfinished() {\n    var filtered = workflows.sort(function (w1, w2) {\n      if (w1.finished && w2.finished) {\n        if (w1.starred && w1.starred) {\n          if (w1.id > w2.id) {\n            return -1;\n          }\n\n          return 1;\n        }\n\n        if (w1.starred) {\n          return -1;\n        }\n\n        return 1;\n      } else if (w1.finished) return 1;\n\n      return -1;\n    });\n    setWorkflows(_toConsumableArray(filtered));\n    setCurFilter('finished');\n  };\n\n  var filterByStarred = function filterByStarred() {\n    var filtered = workflows.sort(function (w1, w2) {\n      if (w1.starred && w2.starred) {\n        if (w1.finished && w1.finished) {\n          if (w1.id > w1.id) {\n            return -1;\n          }\n\n          return 1;\n        }\n\n        if (w1.finished) {\n          return 1;\n        }\n\n        return -1;\n      } else if (w1.starred) return -1;\n\n      return 1;\n    }); // console.log(workflows);\n\n    setWorkflows(_toConsumableArray(filtered));\n    setCurFilter('starred');\n  };\n\n  var removeFilter = function removeFilter() {\n    setWorkflows(_toConsumableArray(origWorkflow));\n    setCurFilter('');\n  };\n\n  return __jsx(\"main\", {\n    className: styles.workflowsContainer,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 3\n    }\n  }, __jsx(\"div\", {\n    className: styles.dashboardMenuContainer,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 4\n    }\n  }, __jsx(DashboardMenu, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 5\n    }\n  })), __jsx(\"div\", {\n    className: styles.workflowsBody,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 4\n    }\n  }, !workflows ? __jsx(\"p\", {\n    className: styles.noWorkflows,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 6\n    }\n  }, \"You don't have any workflows. Let's get one started!\") : __jsx(React.Fragment, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 6\n    }\n  }, __jsx(\"h1\", {\n    className: styles.numWorkflows,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 7\n    }\n  }, workflows.length, \" Workflow\", workflows.length != 1 ? 's' : ''), __jsx(\"ul\", {\n    className: styles.filter,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 7\n    }\n  }, __jsx(\"li\", {\n    onClick: filterByStarred,\n    className: classnames(_defineProperty({}, styles.active, curFilter === 'starred')),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 8\n    }\n  }, \"Starred\"), __jsx(\"li\", {\n    onClick: filterByUnfinished,\n    className: classnames(_defineProperty({}, styles.active, curFilter === 'finished')),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 8\n    }\n  }, \"Unfinished\"), __jsx(\"li\", {\n    onClick: removeFilter,\n    className: styles.clear,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 8\n    }\n  }, \"Clear\")), __jsx(\"div\", {\n    className: styles.workflowList,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 179,\n      columnNumber: 7\n    }\n  }, workflows.map(function (workflow) {\n    return __jsx(\"a\", {\n      href: \"../workflow/\".concat(workflow.id),\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }\n    }, __jsx(WorkflowItem, {\n      workflow: workflow,\n      key: workflow.id,\n      id: workflow.id,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 10\n      }\n    }));\n  }))), __jsx(\"div\", {\n    className: styles.addWorkflowBtn,\n    onClick: function onClick() {\n      return createWorkflow();\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 5\n    }\n  }, \"Add Workflow\")));\n};\n\n_s(Dashboard, \"9J3/5duebb2zbzLTt7qX1Lpmwf4=\", false, function () {\n  return [useSelector, useDispatch];\n});\n\n_c = Dashboard;\nexport default Dashboard;\n\nvar _c;\n\n$RefreshReg$(_c, \"Dashboard\");","map":{"version":3,"sources":["C:/Sarthak/YT_Workflow_Cloud/client/pages/dashboard/workflows.js"],"names":["styles","classnames","useEffect","useState","useSelector","useDispatch","setJwt","setWorkflowInfo","DashboardMenu","WorkflowItem","Cookie","Router","Dashboard","workflows","setWorkflows","jwtToken","state","dispatch","origWorkflow","setOrigWorkflow","curFilter","setCurFilter","push","setWorkflowIdsInLocalStorage","workflowsInfo","workflowIds","map","workflowInfo","id","localStorage","getItem","setItem","getNewJwtToken","refreshToken","data","refresh","dataStringified","JSON","stringify","fetch","method","body","headers","newAccessTokenRes","json","newAccessTokenJson","detail","set","newJwtToken","access","Authorization","workflowsResponse","workflowsJson","getWorkflows","jwtBearerString","code","tempWorkflows","orig","sort","w1","w2","createWorkflow","res","resJson","newWorkflowInfo","filterByUnfinished","filtered","finished","starred","filterByStarred","removeFilter","workflowsContainer","dashboardMenuContainer","workflowsBody","noWorkflows","numWorkflows","length","filter","active","clear","workflowList","workflow","addWorkflowBtn"],"mappings":"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","sourcesContent":["import styles from '../../styles/scss/workflows.module.scss';\r\nimport classnames from 'classnames';\r\nimport { useEffect, useState } from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { setJwt } from '../../components/actions/jwtAction';\r\nimport { setWorkflowInfo } from '../../components/actions/workflowInfo';\r\nimport DashboardMenu from '../../components/DashboardMenu';\r\nimport WorkflowItem from '../../components/WorkflowItem';\r\nimport Cookie from 'js-cookie';\r\nimport Router from 'next/router';\r\nconst Dashboard = () => {\r\n\tconst [ workflows, setWorkflows ] = useState(null);\r\n\tconst jwtToken = useSelector((state) => state.jwtToken);\r\n\tconst dispatch = useDispatch();\r\n\tconst [ origWorkflow, setOrigWorkflow ] = useState([]);\r\n\tconst [ curFilter, setCurFilter ] = useState('');\r\n\tif (jwtToken === '') {\r\n\t\tRouter.push('/');\r\n\t}\r\n\r\n\tconst setWorkflowIdsInLocalStorage = (workflowsInfo) => {\r\n\t\tconst workflowIds = workflowsInfo.map((workflowInfo) => workflowInfo.id);\r\n\t\tif (!localStorage.getItem('workflowIds')) {\r\n\t\t\tlocalStorage.setItem('workflowIds', workflowIds);\r\n\t\t}\r\n\t};\r\n\r\n\tconst getNewJwtToken = async () => {\r\n\t\tconst refreshToken = localStorage.getItem('refresh-token');\r\n\t\tconst data = {\r\n\t\t\trefresh: refreshToken\r\n\t\t};\r\n\t\tconst dataStringified = JSON.stringify(data);\r\n\t\tconst newAccessTokenRes = await fetch('http://127.0.0.1:8000/api/refresh', {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tbody: dataStringified,\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json'\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst newAccessTokenJson = await newAccessTokenRes.json();\r\n\t\tif (newAccessTokenJson.detail === 'Token is invalid or expired') {\r\n\t\t\tlocalStorage.setItem('refresh-token', '');\r\n\t\t\tCookie.set('jwt', JSON.stringify(''));\r\n\t\t\tCookie.set('refresh-token', JSON.stringify(''));\r\n\t\t\tdispatch(setJwt(''));\r\n\t\t\treturn Router.push('/');\r\n\t\t}\r\n\t\tconst newJwtToken = newAccessTokenJson.access;\r\n\t\tdispatch(setJwt(newJwtToken));\r\n\t\tlocalStorage.setItem('jwt', newJwtToken);\r\n\t\tCookie.set('jwt', JSON.stringify(newJwtToken));\r\n\t\tconst workflowsResponse = await fetch('http://localhost:8000/get-workflows', {\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: 'Bearer ' + newJwtToken\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst workflowsJson = await workflowsResponse.json();\r\n\t\tsetWorkflows(workflowsJson['workflows']);\r\n\t\tdispatch(setWorkflowInfo(workflowsJson['workflows']));\r\n\t\tsetWorkflowIdsInLocalStorage(workflowsJson['workflows']);\r\n\t};\r\n\r\n\tconst getWorkflows = async () => {\r\n\t\tconst jwtBearerString = 'Bearer ' + jwtToken;\r\n\t\tconst workflowsResponse = await fetch('http://localhost:8000/get-workflows', {\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: jwtBearerString\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst workflowsJson = await workflowsResponse.json();\r\n\r\n\t\tif (workflowsJson.code) {\r\n\t\t\tawait getNewJwtToken();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst tempWorkflows = workflowsJson['workflows'];\r\n\t\tconst orig = tempWorkflows.sort((w1, w2) => {\r\n\t\t\tif (w1.id > w2.id) return -1;\r\n\t\t\treturn 1;\r\n\t\t});\r\n\t\tsetWorkflows([ ...orig ]);\r\n\t\tsetOrigWorkflow([ ...orig ]);\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tgetWorkflows();\r\n\t}, []);\r\n\r\n\tconst createWorkflow = async () => {\r\n\t\tconst res = await fetch('http://localhost:8000/create-workflow', {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t\tAuthorization: 'Bearer ' + jwtToken\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst resJson = await res.json();\r\n\t\tconst newWorkflowInfo = resJson['workflow'];\r\n\t\tRouter.push(`/../workflow/${newWorkflowInfo.id}`);\r\n\t};\r\n\r\n\tconst filterByUnfinished = () => {\r\n\t\tconst filtered = workflows.sort((w1, w2) => {\r\n\t\t\tif (w1.finished && w2.finished) {\r\n\t\t\t\tif (w1.starred && w1.starred) {\r\n\t\t\t\t\tif (w1.id > w2.id) {\r\n\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t\tif (w1.starred) {\r\n\t\t\t\t\treturn -1;\r\n\t\t\t\t}\r\n\t\t\t\treturn 1;\r\n\t\t\t} else if (w1.finished) return 1;\r\n\t\t\treturn -1;\r\n\t\t});\r\n\t\tsetWorkflows([ ...filtered ]);\r\n\t\tsetCurFilter('finished');\r\n\t};\r\n\r\n\tconst filterByStarred = () => {\r\n\t\tconst filtered = workflows.sort((w1, w2) => {\r\n\t\t\tif (w1.starred && w2.starred) {\r\n\t\t\t\tif (w1.finished && w1.finished) {\r\n\t\t\t\t\tif (w1.id > w1.id) {\r\n\t\t\t\t\t\treturn -1;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t\tif (w1.finished) {\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t\treturn -1;\r\n\t\t\t} else if (w1.starred) return -1;\r\n\t\t\treturn 1;\r\n\t\t});\r\n\t\t// console.log(workflows);\r\n\t\tsetWorkflows([ ...filtered ]);\r\n\t\tsetCurFilter('starred');\r\n\t};\r\n\r\n\tconst removeFilter = () => {\r\n\t\tsetWorkflows([ ...origWorkflow ]);\r\n\t\tsetCurFilter('');\r\n\t};\r\n\r\n\treturn (\r\n\t\t<main className={styles.workflowsContainer}>\r\n\t\t\t<div className={styles.dashboardMenuContainer}>\r\n\t\t\t\t<DashboardMenu />\r\n\t\t\t</div>\r\n\t\t\t<div className={styles.workflowsBody}>\r\n\t\t\t\t{!workflows ? (\r\n\t\t\t\t\t<p className={styles.noWorkflows}>You don't have any workflows. Let's get one started!</p>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<React.Fragment>\r\n\t\t\t\t\t\t<h1 className={styles.numWorkflows}>\r\n\t\t\t\t\t\t\t{workflows.length} Workflow{workflows.length != 1 ? 's' : ''}\r\n\t\t\t\t\t\t</h1>\r\n\t\t\t\t\t\t<ul className={styles.filter}>\r\n\t\t\t\t\t\t\t<li\r\n\t\t\t\t\t\t\t\tonClick={filterByStarred}\r\n\t\t\t\t\t\t\t\tclassName={classnames({ [styles.active]: curFilter === 'starred' })}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tStarred\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li\r\n\t\t\t\t\t\t\t\tonClick={filterByUnfinished}\r\n\t\t\t\t\t\t\t\tclassName={classnames({ [styles.active]: curFilter === 'finished' })}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\tUnfinished\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t\t<li onClick={removeFilter} className={styles.clear}>\r\n\t\t\t\t\t\t\t\tClear\r\n\t\t\t\t\t\t\t</li>\r\n\t\t\t\t\t\t</ul>\r\n\t\t\t\t\t\t<div className={styles.workflowList}>\r\n\t\t\t\t\t\t\t{workflows.map((workflow) => (\r\n\t\t\t\t\t\t\t\t<a href={`../workflow/${workflow.id}`}>\r\n\t\t\t\t\t\t\t\t\t<WorkflowItem workflow={workflow} key={workflow.id} id={workflow.id} />\r\n\t\t\t\t\t\t\t\t</a>\r\n\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</React.Fragment>\r\n\t\t\t\t)}\r\n\t\t\t\t<div className={styles.addWorkflowBtn} onClick={() => createWorkflow()}>\r\n\t\t\t\t\tAdd Workflow\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</main>\r\n\t);\r\n};\r\n\r\nexport default Dashboard;\r\n"]},"metadata":{},"sourceType":"module"}